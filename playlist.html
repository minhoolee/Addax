<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Addax</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js"></script>
</head>

<style>
    /* body:not(#playlist) {
        margin: 0;
        height: 100%;
        overflow: hidden
    }*/
    
    body {
        background: #F1F1F1
    }
    
    #descriptionStyles {
        color: #A3B3BF;
        font-size: 10px
    }
    
    #playlist {
        overflow: auto;
        max-height: 100vh;
    }
</style>
<script>
    var server_data = [];
    //initial script to load everything up
    $.get("http://AddaxServer-env.ubepzwztwv.us-west-2.elasticbeanstalk.com/all", function(data) {

        console.log("before")
        console.log(data)
        server_data = mergeSort(data);
        loadVideos(server_data);
    })



    function loadVideos(data) {
        var elem = document.getElementById('suckMyDick')
        var source = document.createElement('source')

        source.setAttribute('id', 'dick')
        source.setAttribute('src', data[0].link)
        elem.appendChild(source)
        elem.play()

        var mainDiv = document.getElementById('playlist')
        for (i = 0; i < data.length; i++) {
            var rowDiv = document.createElement('div')
            rowDiv.setAttribute('class', 'row')

            var imgDiv = document.createElement('div')
            imgDiv.setAttribute('class', 'col s7')
            var img = document.createElement('img')
            img.setAttribute('class', 'responsive_img col s12')
            img.setAttribute('src', 'cool_pic.jpg')

            rowDiv.appendChild(imgDiv)
            imgDiv.appendChild(img)

            var descriptionDiv = document.createElement('div')
            descriptionDiv.setAttribute('class', 'col s5')
            var titleText = document.createElement('h6')
            $(titleText).html(i)
            var viewCount = document.createElement('h6')
            viewCount.setAttribute("id", "descriptionStyles")
            $(viewCount).html(data[i].views + "views")
            var score = document.createElement('h6')
            score.setAttribute("id", "descriptionStyles")
            $(score).html(data[i].score + "/10")

            descriptionDiv.appendChild(titleText)
            descriptionDiv.appendChild(viewCount)
            descriptionDiv.appendChild(score)

            rowDiv.appendChild(descriptionDiv)
            console.log(data)
            rowDiv.setAttribute('onClick', 'playVid(\"' + data[i].link.toString() + '\")')
            rowDiv.setAttribute('id', 'thumbnail')
            playlist.appendChild(rowDiv)
        }
    }

    function playVid(url) {
        console.log(url);
        var elem = document.getElementById('suckMyDick')
        elem.pause()
        var source = document.getElementById('dick')
        source.setAttribute('src', url)
        elem.load()
        elem.play()
    }

    function mergeSort(arr) {
        if (arr.length < 2)
            return arr;

        var middle = parseInt(arr.length / 2);
        var left = arr.slice(0, middle);
        var right = arr.slice(middle, arr.length);

        console.log(document.getElementById('checked').checked);
        if (document.getElementById('checked').checked) {
            console.log("calling score");
            return mergeScore(mergeSort(left), mergeSort(right));
        } else {
            console.log("calling views");
            return mergeViews(mergeSort(left), mergeSort(right));
        }

    }

    function mergeScore(left, right) {
        console.log("merge score called");
        var result = [];

        while (left.length && right.length) {
            if (left[0].score >= right[0].score) {
                result.push(left.shift());
            } else {
                result.push(right.shift());
            }
        }

        while (left.length)
            result.push(left.shift());

        while (right.length)
            result.push(right.shift());

        return result;
    }

    function mergeViews(left, right) {
        console.log("merge views called");
        var result = [];

        while (left.length && right.length) {
            if (left[0].views >= right[0].views) {
                result.push(left.shift());
            } else {
                result.push(right.shift());
            }
        }

        while (left.length)
            result.push(left.shift());

        while (right.length)
            result.push(right.shift());

        return result;
    }
</script>


<body>
    <!-- Dropdown Structure -->
    <ul id="dropdown1" class="dropdown-content">
        <li><a href="#!">Full Playlist</a></li>
        <li><a href="#!">Our Favorites</a></li>
        <li><a href="#!">Trending</a></li>
    </ul>
    <nav>
        <div class="nav-wrapper">
            <ul class="left hide-on-med-and-down">
                <!-- Dropdown Trigger -->
                <li><a class="dropdown-button" href="#!" data-activates="dropdown1"><i class="material-icons right">arrow_drop_down</i></a></li>
            </ul>
        </div>
    </nav>
    <div class="row">
        <div class="row">
            <div class="col s1"></div>
            <div class="col s8 ">
                <div class="row card z-depth-0" style="background:#F1F1F1">
                    <div class="row">
                        <video class="responsive-video" id="suckMyDick" controls></video>
                    </div>
                </div>

                <div class="row card" style="top:-4.5vh">
                    <div class="col s8">
                        <h5>Video Name</h5>
                        <h6>Company Description goes here</h6>
                    </div>
                    <div class="col s4">
                        <div class="row"></div>
                        <div class="row"></div>
                        <h6 class="right-align">500 Views</h6>
                        <h6 class="right-align">Rated 99/100</h6>
                    </div>

                </div>
            </div>
            <div class="col s2 card" id="playlist">
                <div class="row">
                </div>
                <div class="row">
                    <form class="col s12">
                        <div class="row">
                            <div class="switch"><label>By Views<input id="checked" type="checkbox" checked><span class="lever"></span>By Rating</label></div>
                        </div>
                    </form>
                </div>
                <div class="row">
                </div>

            </div>
        </div>
    </div>
</body>

<script>
    $(".switch").on("change", function() {
        var playTab = document.getElementById("playlist")
        $('#playlist').children('#thumbnail').remove();
        server_data = mergeSort(server_data);
        loadVideos(server_data);
        var elem = document.getElementById('suckMyDick')
        elem.pause()
        var source = document.getElementById('dick')
        source.setAttribute('src', server_data[0].link)
        elem.load()

        elem.play()
        console.log("updated");
        console.log(server_data);
    });
</script>

</html>